# Architecture Issues Index

> **Central reference** for all 49 identified issues from the 12-agent research analysis.

**Navigation:**
- **[INDEX.md](./INDEX.md)** - Start here for new sessions
- **[ARCHITECTURE-IMPROVEMENT-FINDINGS.md](./ARCHITECTURE-IMPROVEMENT-FINDINGS.md)** - Main tracking with detailed findings

---

## Detailed Findings Files

| Agent # | Focus Area | Detailed File |
|---------|------------|---------------|
| 1 | Maintainability | [ARCHITECTURE-IMPROVEMENT-FINDINGS.md](./ARCHITECTURE-IMPROVEMENT-FINDINGS.md) ¬ß1 |
| 2 | Type Safety | [TYPE-SAFETY-DETAILED.md](./TYPE-SAFETY-DETAILED.md) |
| 3 | Prompting Techniques | [ARCHITECTURE-IMPROVEMENT-FINDINGS.md](./ARCHITECTURE-IMPROVEMENT-FINDINGS.md) ¬ß3 |
| 4 | Scalability | [SCALABILITY-ANALYSIS.md](./SCALABILITY-ANALYSIS.md) |
| 5 | DRY Principles | [DRY-PRINCIPLES-AGENT5-FINDINGS.md](./DRY-PRINCIPLES-AGENT5-FINDINGS.md) |
| 6 | Template Architecture | [TEMPLATE-ARCHITECTURE-FINDINGS.md](./TEMPLATE-ARCHITECTURE-FINDINGS.md) |
| 7 | Compilation Pipeline | [COMPILATION-PIPELINE-FINDINGS.md](./COMPILATION-PIPELINE-FINDINGS.md) |
| 8 | Profile System | [PROFILE-SYSTEM-FINDINGS.md](./PROFILE-SYSTEM-FINDINGS.md) |
| 9 | Skill Architecture | [ARCHITECTURE-IMPROVEMENT-FINDINGS.md](./ARCHITECTURE-IMPROVEMENT-FINDINGS.md) ¬ß9 |
| 10 | XML Tag Strategy | [10-XML-TAG-STRATEGY-FINDINGS.md](./10-XML-TAG-STRATEGY-FINDINGS.md) |
| 11 | Model-Specific Optimizations | [MODEL-SPECIFIC-OPTIMIZATIONS-FINDINGS.md](./MODEL-SPECIFIC-OPTIMIZATIONS-FINDINGS.md) |
| 12 | Testing & Verification | [ARCHITECTURE-IMPROVEMENT-FINDINGS.md](./ARCHITECTURE-IMPROVEMENT-FINDINGS.md) ¬ß12 |

---

## All 49 Issues by Severity

### RESOLVED (2 issues)

#### 1. Compiled Agents Consume ~17% of Context Window *(RESOLVED 2026-01-08)*
**Source:** Agent #4 (Scalability)
**Status:** ‚úÖ **RESOLVED** - 17% context usage in worst case is acceptable for short-lived subagents

**Original Claim:** Compiled agents take up 30-35% of a 100K context window.

**Resolution:**
- Subagents have their **own 200K token context window** (not 100K)
- The largest agent (frontend-reviewer at 138KB = ~34,500 tokens) uses **17.3% of 200K**
- Subagents are **short-lived** - context is released after task completion
- Parent context is **unaffected** by subagent context usage

**Actual Measurements:**
| Agent | Bytes | Tokens (~) | % of 200K |
|-------|-------|------------|-----------|
| frontend-reviewer | 138,230 | 34,558 | 17.3% |
| frontend-developer | 120,735 | 30,184 | 15.1% |
| tester | 109,792 | 27,448 | 13.7% |

**Conclusion:** The trade-off (17% context for comprehensive instructions) is acceptable for short-lived subagents. No action required.

---

### CRITICAL (3 issues)

#### 2. No Automated Test Suite
**Source:** Agent #12 (Testing & Verification)
**What:** Zero test files exist (`*.test.ts`, `*.spec.ts`). The compiler has no tests.

**Consequence:**
- You can break the compiler and not know until production
- Refactoring is dangerous (no safety net)
- Contributors fear making changes
- Regressions accumulate silently

---

#### 3. No CI/CD Pipeline
**Source:** Agent #12 (Testing & Verification)
**What:** No `.github/workflows/` directory. No automated checks on PRs.

**Consequence:**
- Bad code gets merged
- Manual verification required every time
- Team members can push broken configs
- No status checks = no quality gates

---

#### 4. Dynamic Skill Invocation is Fake *(RESOLVED 2026-01-08)*
**Source:** Agent #9 (Skill Architecture)
**Status:** ‚úÖ **RESOLVED** - All skills now have proper YAML frontmatter

**Original Claim:** The `skill: "frontend-api"` syntax doesn't work. There's no Skill tool.

**Resolution:**
All skill source files in `src/profiles/home/skills/` and `src/profiles/work/skills/` have been updated with proper YAML frontmatter in the format:
```yaml
---
name: skill-name
description: What this skill does
---
```

**Skills Updated (36 total):**
- **Home Profile Frontend (8):** react, styling, api, client-state, accessibility, performance, testing, mocking
- **Home Profile Backend (10):** api, authentication, database, ci-cd, performance, testing, analytics, feature-flags, email, observability
- **Home Profile Setup (7):** monorepo, package, env, tooling, posthog, resend, observability
- **Home Profile Shared/Security (2):** reviewing, security
- **Home Profile Research (1):** methodology
- **Work Profile Frontend (8):** api, accessibility, testing, styling, performance, react, mocking, client-state

**What Was Done:**
1. Audited all 36 skill files across both profiles
2. Added YAML frontmatter with `name` and `description` fields to each
3. Used the name/description from `skills.yaml` for consistency

**Note:** The compiled output in `.claude/skills/` will need to be regenerated by the compiler to include the frontmatter. The source skills are now correctly formatted for Claude Code's native Skill tool discovery system.

---

#### 5. Schema/Compiler Mismatch for Skill Overrides
**Source:** Agent #1 (Maintainability)
**What:** The JSON schema documents that you can override `path`, `name`, `description` in skill references. The compiler ignores ALL of these - only `usage` is used.

**Consequence:**
- ~200 lines of work config are dead code (silently ignored)
- Contributors think overrides work - they don't
- Wasted effort maintaining metadata that's discarded

---

### HIGH Priority (14 issues)

#### 6. Schema Validation is IDE-Only
**Source:** Agent #2 (Type Safety)
**What:** JSON schemas exist but the `yaml` library doesn't validate against them at runtime.

**Consequence:** Typos in YAML files compile without error. You only discover problems when TypeScript complains about missing properties - or worse, at runtime.

---

#### 7. Config File Redundancy (625+ lines) *(Re-investigated 2026-01-08)*
**Source:** Agent #1 (Maintainability)
**What:** The home profile config is 625 lines. The skill `frontend/react` appears 9 times for different agents.

**Consequence:** Adding a new skill means editing 9+ places. Easy to miss one. 625 lines should be ~300 with proper abstractions.

**Root Causes Identified:**
1. **Skill assignment duplication**: `frontend/react` appears in 9 agents
2. **Core/ending prompts repetition**: Same arrays repeated 15+ times
3. **No default inheritance**: Every agent must specify all 4 properties
4. **Verbose work config**: `path/name/description` overrides are silently ignored by compiler

**Recommended Solutions (Phased):**

**Phase 1 - YAML Anchors (No code changes, ~40% reduction):**
```yaml
defaults: &defaults
  core_prompts: [core-principles, investigation-requirement, write-verification, anti-over-engineering]
  ending_prompts: [context-management, improvement-protocol]

skill_bundles:
  frontend_core: &frontend_core
    - {id: frontend/react, usage: when working with React}
    - {id: frontend/styling, usage: when working with styles}

agents:
  frontend-developer:
    <<: *defaults
    precompiled: *frontend_core
```

**Phase 2 - Profile Defaults (Small code change, additional ~20-30%):**
Add `defaults` section to profile config schema that agents inherit automatically.

**Phase 3 - Skill Bundles (Medium code change):**
Named skill groups with `extends` support in `skills.yaml`.

---

#### 8. Multi-File Update Workflow (5-7 files per agent) *(Re-investigated 2026-01-08)*
**Source:** Agent #1 (Maintainability)
**Status:** üìã **PLANNED** - Scaffolding CLI will be implemented (see ISSUE-7-8-PROPOSALS.md)
**What:** Adding a new agent requires:
1. Create agent directory (5 files)
2. Add to `agents.yaml`
3. Add to `home/config.yaml`
4. Add to `work/config.yaml`
5. Maybe add skills to `skills.yaml`
6. Maybe create skill files

**Consequence:** High barrier for contributors. Easy to forget a file. 45-60 minutes for a new contributor vs 5 minutes with scaffolding.

**Recommended Solution - Scaffolding CLI:**

Create `npm run create:agent` that:
```bash
npm run create:agent -- --name=frontend-optimizer --archetype=developer
```

Interactive mode prompts for:
- Agent name (kebab-case)
- Archetype (developer/reviewer/researcher/pm/custom)
- Title and description
- Profiles to add to
- Precompiled and dynamic skills

**Files auto-generated:**
- `agent-sources/{name}/` directory with 5 template files (from archetype)
- Updates `agents.yaml`
- Updates all selected `profiles/{profile}/config.yaml`

**Agent Archetypes:**
```yaml
archetypes:
  developer:
    base_tools: [Read, Write, Edit, Grep, Glob, Bash]
    output_format: output-formats-developer
    model: opus
  reviewer:
    base_tools: [Read, Write, Edit, Grep, Glob, Bash]
    output_format: output-formats-reviewer
  researcher:
    base_tools: [Read, Grep, Glob, Bash]  # No Write/Edit
    output_format: output-formats-researcher
```

**DX Impact:** Reduces agent creation from 45-60 minutes to ~2 minutes.

---

#### 9. Verification Scripts Are Doc-Only
**Source:** Agent #12 (Testing & Verification)
**What:** The BIBLE documents 6 verification scripts including a full `verify-agent.sh`. But no actual script files exist.

**Consequence:** Users must copy-paste from docs. Scripts aren't version-controlled. Nobody actually runs them.

---

#### 10. No Skill Versioning *(Researched 2026-01-08)*
**Source:** Agent #9 (Skill Architecture)
**Status:** ‚ùå **NOT NEEDED** - Git history sufficient, no external consumers

**Original Claim:** Skills have no version field. No way to track evolution.

**Research Conclusion:**
- Git history already provides complete versioning (commit hashes more precise than semver)
- No external consumers of agents/skills (internal consumption only)
- Single maintainer - versioning disciplines teams, not needed here
- Prompts don't have "APIs" - "breaking change" is subjective for prompts
- Zero overhead wins over marginal benefit

---

#### 11. No Skill Dependencies *(Researched 2026-01-08)*
**Source:** Agent #9 (Skill Architecture)
**Status:** ‚ùå **NOT NEEDED** - Skills are self-contained, bundles solve grouping

**Original Claim:** Skills can't declare relationships (requires, enhances, conflicts).

**Research Conclusion:**
- Skills are self-contained documentation - cross-references are informational, not functional
- Agent configs already explicitly list needed skills (clear and predictable)
- Skill bundles (Issue #7 proposal) solve grouping more elegantly without dependency resolution
- Dependencies would add complexity: circular dep detection, resolution order, bloat prevention
- Explicit is better than implicit for this use case

---

#### 12. Redundant Skill Compilation
**Source:** Agent #9 (Skill Architecture)
**What:** Both precompiled AND dynamic skills get compiled to `.claude/skills/`. The only difference is precompiled are ALSO embedded in agents.

**Consequence:** Wasted disk space. Confusing architecture. The distinction provides minimal value.

---

#### 13. Workflow Files ~80% Duplicated
**Source:** Agent #5 (DRY Principles)
**What:** `frontend-developer/workflow.md` and `backend-developer/workflow.md` share 8 identical sections verbatim.

**Consequence:** Update one, forget the other. Drift accumulates. 2x maintenance burden for identical content.

---

#### 14. No Config Defaults Mechanism
**Source:** Agent #5 (DRY Principles)
**What:** Same `core_prompts` array (6 items) and `ending_prompts` array repeated 15+ times.

**Consequence:** Every agent manually specifies the same arrays. One typo = one broken agent. Should inherit from profile defaults.

---

#### 15. No File Caching in Compiler
**Source:** Agent #4 (Scalability)
**What:** `core-principles.md` is read 17 times (once per agent compilation).

**Consequence:** Slow compilation. Unnecessary I/O. Same content loaded repeatedly.

---

#### 16. Sequential Compilation
**Source:** Agent #4 (Scalability)
**What:** Agents compiled in a for-loop, one at a time.

**Consequence:** Could be 3-5x faster with `Promise.all()`. Wastes developer time on every compile.

---

#### 17. Undocumented Workflow Tags (15+)
**Source:** Agent #10 (XML Tag Strategy)
**What:** Tags like `<mandatory_investigation>`, `<development_workflow>`, `<complexity_protocol>` are used throughout but not in the "13 Required Tags" list.

**Consequence:** New contributors don't know these exist. No validation. Documentation lies by omission.

---

#### 18. Excessive Template Whitespace
**Source:** Agent #6 (Template Architecture)
**What:** `{% for %}` tags produce double blank lines in compiled output.

**Consequence:** Wasted tokens on whitespace. Ugly output. Fix: use `{%-` and `-%}` control tags.

---

#### 19. Missing MUST/SHOULD Classification
**Source:** Agent #3 (Prompting Techniques)
**What:** All rules use `**(You MUST...)**` with equal weight.

**Consequence:** Agents can't prioritize. Everything seems equally critical. Should use `CR-1 (MUST)` vs `CR-3 (SHOULD)`.

---

### MEDIUM Priority (18 issues)

#### 20. No DRY for Prompt Sets
**Source:** Agent #1 (Maintainability)
Same 4 core_prompts + 2 ending_prompts copy-pasted 12+ times in config.

---

#### 21. Inconsistent Config Formats
**Source:** Agent #1 (Maintainability)
Work config uses verbose format (ignored). Home uses minimal. Should standardize.

---

#### 22. Documentation Navigation
**Source:** Agent #1 (Maintainability)
1023-line BIBLE is too long. Needs splitting. No QUICKSTART.md.

---

#### 23. No Compiled Output Validation
**Source:** Agent #12 (Testing & Verification)
XML tags and final lines not verified after compilation.

---

#### 24. No Content Linting
**Source:** Agent #12 (Testing & Verification)
Skills can omit sections. No "think" word detection.

---

#### 25. No Pre-Commit Hooks
**Source:** Agent #12 (Testing & Verification)
Bad code can be committed before any validation.

---

#### 26. Massive Skill Config Duplication
**Source:** Agent #9 (Skill Architecture)
Same skill assigned to 9+ agents with repeated usage text.

---

#### 27. No Skill Composition
**Source:** Agent #9 (Skill Architecture)
Can't extend, layer, or bundle skills.

---

#### 28. No Skill Chunking
**Source:** Agent #9 (Skill Architecture)
All ~970 lines of a skill load every time. Can't load just `<patterns>`.

---

#### 29. Inconsistent Skill ID Format
**Source:** Agent #9 (Skill Architecture)
`frontend/react` in config vs `frontend-react` in compiled output.

---

#### 30. Monolithic Template (95 lines)
**Source:** Agent #6 (Template Architecture)
No partials. Could extract `_preloaded_content.liquid`.

---

#### 31. Reviewer Workflows ~75% Duplicated
**Source:** Agent #5 (DRY Principles)
frontend-reviewer and backend-reviewer share structure.

---

#### 32. Researcher Workflows ~70% Duplicated
**Source:** Agent #5 (DRY Principles)
frontend-researcher and backend-researcher share structure.

---

#### 33. No Incremental Compilation
**Source:** Agent #4 (Scalability)
Always `rm -rf` everything. Should use timestamp-based selective rebuild.

---

#### 34. No Context Budget Enforcement
**Source:** Agent #4 (Scalability)
No warning when agent exceeds reasonable size.

---

#### 35. Skill-Specific Tags Undocumented
**Source:** Agent #10 (XML Tag Strategy)
`<philosophy>`, `<patterns>`, `<anti_patterns>` not documented.

---

#### 36. Missing 3-Tier Skill Disclosure
**Source:** Agent #3 (Prompting Techniques)
Binary precompiled/dynamic. Should have metadata‚Üíinstructions‚Üíexamples tiers.

---

#### 37. Negative Framing in anti-over-engineering.md
**Source:** Agent #3 (Prompting Techniques)
Uses "‚ùå Don't create" patterns. Should be "‚úÖ Use existing".

---

### LOW Priority (12 issues)

#### 38. Legacy compile.mjs
**Source:** Agent #1 (Maintainability)
Old file exists alongside compile.ts.

---

#### 39. Undocumented agent-outputs/ Directory
**Source:** Agent #1 (Maintainability)
8 files, not mentioned in docs.

---

#### 40. No Active Profile Indicator
**Source:** Agent #1 (Maintainability)
No `.claude/.active-profile` file.

---

#### 41. No Integration Tests
**Source:** Agent #12 (Testing & Verification)
Can't test agents with actual Claude Code.

---

#### 42. No Skill Templates
**Source:** Agent #9 (Skill Architecture)
New skills created manually.

---

#### 43. No Skill Validation
**Source:** Agent #9 (Skill Architecture)
Structure not enforced.

---

#### 44. No Skill Metrics
**Source:** Agent #9 (Skill Architecture)
Usage/effectiveness unknown.

---

#### 45. Hardcoded Template Text
**Source:** Agent #6 (Template Architecture)
Can't customize without modifying template.

---

#### 46. Missing Liquid Filters
**Source:** Agent #6 (Template Architecture)
`strip`, `truncate`, `default` unused.

---

#### 47. Verification Script grep Bug
**Source:** Agent #10 (XML Tag Strategy)
Uses `grep -c` (count) not `grep -q` (boolean).

---

#### 48. Verbose XML Tag Names
**Source:** Agent #10 (XML Tag Strategy)
`<write_verification_protocol>` (26 chars) could be `<verify_writes>` (13 chars).

---

#### 49. Some Prompts Still Use "think"
**Source:** Agent #3 (Prompting Techniques)
80% compliance. Should be 100% for Opus.

---

## Summary Statistics

| Severity | Count | % of Total | Notes |
|----------|-------|------------|-------|
| RESOLVED | 2 | 4% | Issues #1 and #4 resolved |
| CRITICAL | 3 | 6% | |
| HIGH | 14 | 29% | |
| MEDIUM | 18 | 37% | |
| LOW | 12 | 24% | |
| **Total** | **49** | 100% | |

> **Note (2026-01-08):** Issue #1 was RESOLVED after re-investigation showed subagents have 200K context (not 100K), use only ~17% in worst case, and are short-lived. This is acceptable behavior, not a critical issue.
>
> **Note (2026-01-08):** Issue #4 was RESOLVED by adding proper YAML frontmatter to all 36 skill source files across both home and work profiles. Skills now have the required `name` and `description` fields for Claude Code's native Skill tool discovery.

### By Research Area

| Agent | Focus | Issues Found |
|-------|-------|--------------|
| #1 | Maintainability | 8 |
| #2 | Type Safety | 1 |
| #3 | Prompting Techniques | 4 |
| #4 | Scalability | 5 |
| #5 | DRY Principles | 4 |
| #6 | Template Architecture | 4 |
| #7 | Compilation Pipeline | (merged into others) |
| #8 | Profile System | (merged into others) |
| #9 | Skill Architecture | 10 |
| #10 | XML Tag Strategy | 4 |
| #11 | Model-Specific Optimizations | (merged into others) |
| #12 | Testing & Verification | 6 |

---

## Recommended Implementation Order

### Phase 1: Foundation (Critical)
1. Add test suite for compiler
2. Add CI/CD pipeline
3. Add Zod runtime validation

### Phase 2: Context Optimization (Critical)
4. Reduce compiled agent sizes (limit precompiled skills)
5. Add file caching to compiler
6. Parallelize compilation

### Phase 3: DRY Refactoring (High)
7. Extract common workflows to core-prompts
8. Implement config defaults mechanism
9. Create skill bundles

### Phase 4: Feature Completion (High)
10. Implement actual dynamic skill loading OR remove the concept
11. Create scaffolding CLI (`npm run create:agent`)
12. Save verification scripts as actual files

### Phase 5: Polish (Medium/Low)
13. Fix template whitespace
14. Add MUST/SHOULD classification
15. Document undocumented tags

---

*Last updated: 2026-01-08 (Issue #4 RESOLVED - Added YAML frontmatter to all 36 skill source files)*
