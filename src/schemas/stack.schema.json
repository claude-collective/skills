{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://claude-collective.local/schemas/stack.schema.json",
  "title": "Stack Configuration",
  "description": "Tech stack definition bundling skills, agents, and philosophy.",
  "type": "object",
  "required": ["name", "version", "author", "skills", "agents"],
  "additionalProperties": false,
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique stack identifier (kebab-case)",
      "pattern": "^[a-z][a-z0-9]*(-[a-z0-9]+)*$",
      "minLength": 1,
      "examples": ["nextjs-fullstack", "angular-stack"]
    },
    "name": {
      "type": "string",
      "description": "Human-readable display name",
      "minLength": 1,
      "examples": ["Modern React Stack"]
    },
    "version": {
      "type": "string",
      "description": "Semantic version (major.minor.patch)",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",
      "examples": ["1.0.0"]
    },
    "author": {
      "type": "string",
      "description": "Creator's handle (with @ prefix)",
      "minLength": 1,
      "examples": ["@vince"]
    },
    "description": {
      "type": "string",
      "description": "Stack purpose and use cases",
      "minLength": 1
    },
    "created": {
      "type": "string",
      "description": "Creation date (ISO 8601)",
      "format": "date"
    },
    "updated": {
      "type": "string",
      "description": "Last update date (ISO 8601)",
      "format": "date"
    },
    "framework": {
      "type": "string",
      "description": "Foundation framework (defines stack identity)",
      "minLength": 1,
      "examples": ["react", "vue", "nextjs"]
    },
    "skills": {
      "type": "array",
      "description": "Skill assignments with optional preloaded flag",
      "minItems": 1,
      "items": { "$ref": "#/$defs/SkillAssignment" }
    },
    "agents": {
      "type": "array",
      "description": "Agent IDs to include",
      "minItems": 1,
      "uniqueItems": true,
      "items": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9]*(-[a-z0-9]+)*$"
      }
    },
    "agent_skills": {
      "type": "object",
      "description": "Per-agent skill assignments by category",
      "additionalProperties": {
        "type": "object",
        "additionalProperties": {
          "type": "array",
          "items": { "$ref": "#/$defs/SkillAssignment" }
        }
      },
      "propertyNames": {
        "pattern": "^[a-z][a-z0-9]*(-[a-z0-9]+)*$"
      }
    },
    "philosophy": {
      "type": "string",
      "description": "Guiding principle or motto",
      "minLength": 1,
      "examples": ["Ship fast, iterate faster"]
    },
    "principles": {
      "type": "array",
      "description": "Development principles for this stack",
      "items": {
        "type": "string",
        "minLength": 1
      }
    },
    "tags": {
      "type": "array",
      "description": "Keywords for discoverability",
      "items": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9]*(-[a-z0-9]+)*$",
        "minLength": 1
      },
      "uniqueItems": true
    },
    "overrides": {
      "type": "object",
      "description": "Skill category override rules",
      "additionalProperties": { "$ref": "#/$defs/OverrideRule" },
      "propertyNames": {
        "pattern": "^[a-z][a-z0-9]*(-[a-z0-9]+)*$"
      }
    },
    "metrics": {
      "$ref": "#/$defs/Metrics",
      "description": "Community engagement metrics"
    },
    "hooks": {
      "type": "object",
      "description": "Lifecycle hooks for stack plugin",
      "additionalProperties": {
        "type": "array",
        "items": { "$ref": "#/$defs/HookDefinition" }
      },
      "propertyNames": {
        "enum": [
          "SessionStart",
          "SessionEnd",
          "UserPromptSubmit",
          "PreToolUse",
          "PostToolUse",
          "PermissionRequest",
          "Stop",
          "SubagentStop",
          "PreCompact",
          "Setup"
        ]
      }
    }
  },
  "$defs": {
    "SkillAssignment": {
      "type": "object",
      "description": "Skill with optional preloaded flag",
      "required": ["id"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Skill ID (e.g., 'react (@vince)')",
          "minLength": 1
        },
        "preloaded": {
          "type": "boolean",
          "description": "Embed full content in compiled agent",
          "default": false
        }
      }
    },
    "OverrideRule": {
      "type": "object",
      "description": "Override configuration for skill category",
      "additionalProperties": false,
      "properties": {
        "alternatives": {
          "type": "array",
          "description": "Alternative skills that can replace default",
          "items": { "type": "string", "minLength": 1 },
          "uniqueItems": true
        },
        "locked": {
          "type": "boolean",
          "description": "Category cannot be overridden",
          "default": false
        }
      }
    },
    "Metrics": {
      "type": "object",
      "description": "Community engagement metrics",
      "additionalProperties": false,
      "properties": {
        "upvotes": {
          "type": "integer",
          "description": "Community upvotes",
          "minimum": 0,
          "default": 0
        },
        "downloads": {
          "type": "integer",
          "description": "Download count",
          "minimum": 0,
          "default": 0
        }
      }
    },
    "HookDefinition": {
      "type": "object",
      "description": "Hook with optional matcher pattern",
      "additionalProperties": false,
      "required": ["hooks"],
      "properties": {
        "matcher": {
          "type": "string",
          "description": "Regex to match tool/event names (e.g., 'Write|Edit')"
        },
        "hooks": {
          "type": "array",
          "description": "Actions to execute",
          "items": { "$ref": "#/$defs/HookAction" },
          "minItems": 1
        }
      }
    },
    "HookAction": {
      "type": "object",
      "description": "Hook action to execute",
      "additionalProperties": false,
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["command", "script", "prompt"]
        },
        "command": {
          "type": "string",
          "description": "Shell command (supports ${CLAUDE_PLUGIN_ROOT})"
        },
        "script": {
          "type": "string",
          "description": "Script path to run"
        },
        "prompt": {
          "type": "string",
          "description": "Prompt text"
        },
        "timeout": {
          "type": "integer",
          "description": "Timeout in seconds",
          "minimum": 1,
          "maximum": 300,
          "default": 30
        }
      }
    }
  }
}
